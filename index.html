<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Mirror Pro | Single File Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root { --accent: #00f2ff; --bg: #0a0a0c; --card: #16161a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .window { background: var(--card); border: 1px solid #333; border-radius: 12px; width: 450px; padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        h2 { margin-top: 0; color: var(--accent); letter-spacing: 1px; }
        input { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: var(--accent); border-radius: 5px; box-sizing: border-box; margin-bottom: 20px; }
        button { width: 100%; padding: 15px; background: var(--accent); color: #000; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #00c8d4; transform: scale(1.02); }
        #log { margin-top: 20px; font-family: monospace; font-size: 11px; height: 80px; overflow-y: auto; background: #000; padding: 10px; border-radius: 4px; color: #888; text-align: left; }
        .loader { display: none; height: 3px; background: var(--accent); width: 0%; transition: width 0.5s; margin-top: 10px; }
    </style>
</head>
<body>

<div class="window">
    <h2>WEB MIRROR</h2>
    <p style="font-size: 13px; color: #aaa;">Klonen von Frontend, Design & Assets in eine ZIP-Datei.</p>
    
    <input type="url" id="targetUrl" placeholder="https://www.zielseite.com" value="https://">
    <button id="btn" onclick="startCloning()">CLONE STARTEN</button>
    <div class="loader" id="loader"></div>
    
    <div id="log">Status: Bereit...</div>
</div>

<script>
    function addLog(msg) {
        const log = document.getElementById('log');
        log.innerHTML += `> ${msg}<br>`;
        log.scrollTop = log.scrollHeight;
    }

    async function startCloning() {
        const url = document.getElementById('targetUrl').value;
        const btn = document.getElementById('btn');
        const loader = document.getElementById('loader');

        if (!url.startsWith('http')) {
            alert("Bitte eine vollst√§ndige URL mit https:// eingeben!");
            return;
        }

        btn.disabled = true;
        loader.style.display = 'block';
        loader.style.width = '30%';
        addLog("Kontaktiere Proxy-Netzwerk...");

        try {
            // Wir nutzen den AllOrigins Proxy, um CORS zu umgehen
            const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
            if (!response.ok) throw new Error("Verbindung fehlgeschlagen.");
            
            const data = await response.json();
            const html = data.contents;

            if (!html) throw new Error("Kein Inhalt empfangen (Sicherheitsblockade).");

            loader.style.width = '60%';
            addLog("HTML empfangen. Extrahiere Design-Pfade...");

            // MAGIC PART: Wir setzen einen <base> Tag, damit alle CSS/Bilder 
            // weiterhin von der Originalseite geladen werden, auch wenn die Datei lokal liegt.
            const baseTag = `<base href="${url}">`;
            let finalHtml = html.replace('<head>', `<head>\n    ${baseTag}`);
            
            // ZIP Erstellung
            const zip = new JSZip();
            zip.file("index.html", finalHtml);
            zip.file("info.txt", `Klon von: ${url}\nDatum: ${new Date().toISOString()}`);

            loader.style.width = '90%';
            addLog("Verpacke Assets in ZIP...");

            const content = await zip.generateAsync({type:"blob"});
            const a = document.createElement("a");
            a.href = URL.createObjectURL(content);
            a.download = "clone_package.zip";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            loader.style.width = '100%';
            addLog("ERFOLG: Download gestartet.");
        } catch (err) {
            addLog("FEHLER: " + err.message);
            console.error(err);
        } finally {
            btn.disabled = false;
            setTimeout(() => { loader.style.display = 'none'; loader.style.width = '0%'; }, 3000);
        }
    }
</script>

</body>
</html>
